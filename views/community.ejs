<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community Hub</title>
<link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
<link href="http://cdn.remixicon.com/releases/v1.1.1/remixicon.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet" />
<link rel="stylesheet" href="/stylesheets/dashboard.css">
</head>
<body class="bg-gradient-to-b from-green-100 via-white to-green-100 to-green-50 min-h-screen">

<!-- Header -->
<header class="flex justify-between items-center p-6 bg-green-600 text-white shadow-md rounded-b-lg">
  <h1 class="text-2xl font-bold">Community Hub</h1>
  <a href="/" class="flex items-center px-4 py-2 bg-white text-green-600 rounded-lg hover:bg-green-100 transition">
    <i class="ri-arrow-left-line mr-2"></i>Back to Home
  </a>
</header>

<!-- Main Container -->
<div class="max-w-7xl mx-auto py-10 px-4 space-y-12">

  <!-- Green Score -->
  <div class="flex justify-end mt-6">
    <div id="greenScore" class="px-5 py-3 bg-green-100 text-green-700 font-semibold rounded-lg shadow-lg hover:bg-green-200 transition transform hover:scale-105 cursor-pointer fixed ">
      Green Score
    </div>
  </div>

  <!-- Organizations Section -->
  <section>
    <h2 class="text-3xl font-bold text-green-700 mb-6 text-center mt-6">Organizations</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <% organizations.forEach(org => { %>
        <div class="bg-white p-6 rounded-2xl shadow hover:shadow-lg transition flex flex-col items-center text-center">
          <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-3xl font-bold text-green-600">
            <%= org.orgName.charAt(0).toUpperCase() %>
          </div>
          <h3 class="mt-4 text-xl font-semibold text-gray-800"><%= org.orgName %></h3>
          <p class="text-gray-500 text-sm mt-1"><%= org.email %></p>
        </div>
      <% }) %>
    </div>
  </section>

  <!-- Students Section -->
  <section>
    <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center mt-6">Students</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <% students.forEach(student => { %>
        <div class="bg-white p-6 rounded-3xl shadow-md hover:shadow-xl transition flex flex-col items-center text-center">
          <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center text-2xl font-bold text-blue-600">
            <%= student.name.charAt(0).toUpperCase() %>
          </div>
          <h3 class="mt-4 text-lg font-semibold text-gray-800"><%= student.name %></h3>
          <p class="text-gray-500 text-sm">Org: <%= student.orgId?.orgName %></p>
        </div>
      <% }) %>
    </div>
  </section>

  <!-- Green Challenges Section -->
  <section>
    <h2 class="text-3xl font-bold text-green-700 mb-6 text-center mt-6">Green Challenges</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
      
      <!-- Switch Off Challenge -->
      <div class="challenge p-4 bg-green-50 rounded-xl shadow-md flex flex-col justify-between items-start hover:bg-green-100 transition">
        <p class="mb-3 font-semibold">Switch Off Challenge</p>
        <p class="text-sm text-gray-600 mb-3">Turn off lights, fans, and devices when not in use</p>
        <% students.forEach(student => { %>
          <a href="#" class="px-3 py-1 mb-1 bg-green-600 text-white rounded-full add-challenge"
             data-student-id="<%= student._id %>" data-points="1">Add Challenge for <%= student.name %></a>
        <% }) %>
      </div>

      <!-- Car-Free Day -->
      <div class="challenge p-4 bg-green-50 rounded-xl shadow-md flex flex-col justify-between items-start hover:bg-green-100 transition">
        <p class="mb-3 font-semibold">Car-Free Day</p>
        <p class="text-sm text-gray-600 mb-3">Walk, cycle, or use public transport once a week</p>
        <% students.forEach(student => { %>
          <a href="#" class="px-3 py-1 mb-1 bg-green-600 text-white rounded-full add-challenge"
             data-student-id="<%= student._id %>" data-points="1">Add Challenge for <%= student.name %></a>
        <% }) %>
      </div>

      <!-- Zero-Food Waste Challenge -->
      <div class="challenge p-4 bg-green-50 rounded-xl shadow-md flex flex-col justify-between items-start hover:bg-green-100 transition">
        <p class="mb-3 font-semibold">Zero-Food Waste Challenge</p>
        <p class="text-sm text-gray-600 mb-3">Cook only what’s needed; compost leftovers</p>
        <% students.forEach(student => { %>
          <a href="#" class="px-3 py-1 mb-1 bg-green-600 text-white rounded-full add-challenge"
             data-student-id="<%= student._id %>" data-points="1">Add Challenge for <%= student.name %></a>
        <% }) %>
      </div>

      <!-- Short Shower Challenge -->
      <div class="challenge p-4 bg-green-50 rounded-xl shadow-md flex flex-col justify-between items-start hover:bg-green-100 transition">
        <p class="mb-3 font-semibold">Short Shower Challenge</p>
        <p class="text-sm text-gray-600 mb-3">5-minute shower max to save water + energy</p>
        <% students.forEach(student => { %>
          <a href="#" class="px-3 py-1 mb-1 bg-green-600 text-white rounded-full add-challenge"
             data-student-id="<%= student._id %>" data-points="1">Add Challenge for <%= student.name %></a>
        <% }) %>
      </div>

    </div>
  </section>

  <!-- Leaderboard Section -->
  <section>
    <h2 class="text-3xl font-bold text-green-700 mb-6 text-center mt-6">Leaderboard</h2>
    <div class="overflow-x-auto">
      <table class="table-auto w-full bg-white rounded-xl shadow-md">
        <thead class="bg-green-100">
          <tr>
            <th class="px-4 py-2 text-left">Rank</th>
            <th class="px-4 py-2 text-left">Name</th>
            <th class="px-4 py-2 text-left">Score</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody">
          <% students.forEach((student, i) => { %>
            <tr id="leaderboard-<%= student._id %>" class="border-b hover:bg-green-50 transition">
              <td class="px-4 py-2"><%= i + 1 %></td>
              <td class="px-4 py-2"><%= student.name %></td>
              <td class="px-4 py-2"><%= student.greenScore %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </section>

  <section id="footerPart">
   
      <footer class="bg-green-600 text-white mt-12 text-center py-4 mt-8 w-full ">
        <p class="text-sm">&copy; <%= new Date().getFullYear() %> Community Hub. All rights reserved.</p>
      </footer>

  </section>

</div>

<script>
const greenScoreDiv = document.getElementById('greenScore');

async function updateScore(studentId, btn, points) {
  try {
    const res = await fetch(`/add-challenge/${studentId}`, { method: 'POST' });
    const data = await res.json();

    const newScore = data.greenScore;
    greenScoreDiv.textContent = `Green Score - ${newScore}`;
    btn.textContent = '✅';
    btn.disabled = true;

    const row = document.getElementById(`leaderboard-${studentId}`);
    if(row) row.cells[2].textContent = newScore;

    // Re-sort leaderboard
    const tbody = document.getElementById('leaderboardBody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    rows.sort((a,b) => parseInt(b.cells[2].textContent) - parseInt(a.cells[2].textContent));
    rows.forEach((r,i) => {
      r.cells[0].textContent = i+1;
      tbody.appendChild(r);
    });

  } catch(err) {
    console.error(err);
    alert("Error updating score");
  }
}

document.querySelectorAll('.add-challenge').forEach(btn => {
  btn.addEventListener('click', (e)=>{
    e.preventDefault();
    if(btn.textContent !== '✅') {
      const studentId = btn.dataset.studentId;
      const points = btn.dataset.points || 1;
      updateScore(studentId, btn, points);
    }
  });
});
</script>

</body>
</html>
